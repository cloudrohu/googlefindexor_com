<!-- HERO SEARCH -->
<section class="bg-gradient-to-r from-indigo-600 to-blue-600 text-white py-20">
    <div class="max-w-7xl mx-auto px-6 text-center">
        <h1 class="text-4xl md:text-5xl font-bold mb-4">
            Find Trusted Businesses Near You
        </h1>

        <p class="text-lg mb-8">
            Search & connect with verified local businesses
        </p>

          
        <form method="get"
              action="/"
              class="bg-white rounded-xl p-4 flex flex-col md:flex-row gap-3 relative">
            <!-- CITY SELECT -->
            <select name="city"
                    class="px-4 py-3 rounded-lg border text-gray-700">
                <option value="">Select City</option>
                {% for city in cities %}
                    <option value="{{ city.id }}"
                        {% if city.id|stringformat:"s" == selected_city %}selected{% endif %}>
                        {{ city.title }}
                    </option>
                {% endfor %}
            </select>

            <!-- SEARCH INPUT WITH AUTOSUGGEST -->
            <div class="relative flex-1">
                <input type="text"
                       id="searchInput"
                       name="q"
                       value="{{ search_query|default:'' }}"
                       autocomplete="off"
                       placeholder="Search business, locality or service"
                       class="w-full px-4 py-3 rounded-lg border outline-none text-gray-700">

                <!-- SUGGESTION BOX -->
                <div id="suggestions"
                     class="absolute left-0 right-0 bg-white text-gray-800
                            rounded-lg shadow-lg mt-1 hidden z-50 max-h-72 overflow-y-auto">
                </div>
            </div>

            
            <button class="bg-indigo-600 text-white px-6 py-3 rounded-lg font-semibold">
                Search
            </button>
        </form>
    </div>
</section>

{% if search_query or selected_city %}
<section class="py-16">
    <div class="max-w-7xl mx-auto px-6">

        {% if companies %}
            <h2 class="text-2xl font-bold mb-6">
                Search Results
            </h2>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                {% for company in companies %}
                <div class="bg-white border rounded-xl p-5 shadow hover:shadow-lg transition">
                    <h3 class="font-bold text-xl">
                        {{ company.company_name }}
                    </h3>

                    <p class="text-sm text-gray-600">
                        {{ company.locality }}, {{ company.city }}
                    </p>

                    <a href="{{ company.get_absolute_url }}"
                       class="inline-block mt-4 bg-indigo-600 text-white px-4 py-2 rounded-lg">
                        View Details
                    </a>
                </div>
                {% endfor %}
            </div>

        {% else %}
            <p class="text-center text-gray-500 text-lg">
                No businesses found matching your search.
            </p>
        {% endif %}

    </div>
</section>
{% endif %}



<!-- CATEGORIES -->
<section class="py-16 bg-gray-50">
    <div class="max-w-7xl mx-auto px-6">

        <h2 class="text-3xl font-bold text-center mb-10">
            Popular Categories
        </h2>

        <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-6">

            {% for cat in categories %}
            <a href="{{ cat.get_absolute_url }}"
               class="bg-white p-6 rounded-xl shadow
                      hover:shadow-lg hover:-translate-y-1
                      transition text-center block">

                {% if cat.icon %}
                    <img src="{{ cat.icon.url }}"
                         alt="{{ cat.title }}"
                         class="w-12 h-12 mx-auto mb-3 object-contain">
                {% else %}
                    <!-- fallback icon -->
                    <div class="w-12 h-12 mx-auto mb-3 rounded-full bg-gray-200 flex items-center justify-center text-gray-500 text-xs">
                        Icon
                    </div>
                {% endif %}

                <h3 class="font-semibold text-gray-800 text-sm">
                    {{ cat.title }}
                </h3>

            </a>
            {% empty %}
            <p class="col-span-full text-center text-gray-500">
                No categories found
            </p>
            {% endfor %}

        </div>

    </div>
</section>

<!-- FEATURED BUSINESSES -->
<section class="py-16">
    <div class="max-w-7xl mx-auto px-6">
        <h2 class="text-3xl font-bold text-center mb-10">Featured Businesses</h2>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
            {% for company in featured_companies %}
            <div class="bg-white border rounded-xl p-5 shadow">
                <h3 class="font-bold text-xl">{{ company.company_name }}</h3>
                <p class="text-sm text-gray-600">
                    {{ company.locality }}, {{ company.city }}
                </p>

                <a href="{{ company.get_absolute_url }}"
                   class="inline-block mt-4 bg-indigo-600 text-white px-4 py-2 rounded-lg">
                    View Details
                </a>
            </div>
            {% endfor %}
        </div>
    </div>
</section>


<section class="py-16">
  <div class="max-w-7xl mx-auto px-6">
    <h2 class="text-3xl font-bold text-center mb-10">
      Featured Businesses
    </h2>

    <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
      <div class="border rounded-xl p-5 shadow hover:shadow-lg">
        <h3 class="font-bold text-xl">Nilkanth Estate Agency</h3>
        <p class="text-gray-600 text-sm">Virar West, Mumbai</p>
        <p class="mt-2 text-yellow-500">‚≠ê‚≠ê‚≠ê‚≠ê‚òÜ</p>

        <div class="mt-4 flex gap-3">
          <a class="bg-green-500 text-white px-4 py-2 rounded-lg">Call</a>
          <a class="bg-blue-500 text-white px-4 py-2 rounded-lg">Details</a>
        </div>
      </div>
    </div>
  </div>
</section>



<section class="bg-gray-100 py-16">
  <div class="max-w-7xl mx-auto px-6 text-center">
    <h2 class="text-3xl font-bold mb-10">Why Choose Findexors?</h2>

    <div class="grid md:grid-cols-4 gap-6">
      <div class="bg-white p-6 rounded-xl shadow">
        <h3 class="font-semibold">‚úî Verified Businesses</h3>
      </div>
      <div class="bg-white p-6 rounded-xl shadow">
        <h3 class="font-semibold">üìç Local Search</h3>
      </div>
      <div class="bg-white p-6 rounded-xl shadow">
        <h3 class="font-semibold">‚ö° Fast Contact</h3>
      </div>
      <div class="bg-white p-6 rounded-xl shadow">
        <h3 class="font-semibold">üíº Free Listing</h3>
      </div>
    </div>
  </div>
</section>



<section class="py-20 bg-indigo-700 text-white text-center">
  <h2 class="text-3xl font-bold mb-4">
    Grow Your Business with Findexors
  </h2>
  <p class="mb-6">List your business and get quality leads</p>

  <a href="#" class="bg-white text-indigo-700 px-8 py-3 rounded-xl font-semibold">
    Add Your Business
  </a>
</section>


<script>
const input = document.getElementById("searchInput");
const box = document.getElementById("suggestions");
let timer = null;

input.addEventListener("keyup", function () {
    clearTimeout(timer);
    const q = this.value.trim();

    if (q.length < 3) {
        box.classList.add("hidden");
        box.innerHTML = "";
        return;
    }

    timer = setTimeout(() => {
        fetch(`/ajax/search/?q=${encodeURIComponent(q)}`)
            .then(res => res.json())
            .then(data => {
                box.innerHTML = "";

                if (!data || data.length === 0) {
                    box.classList.add("hidden");
                    return;
                }

                data.forEach(item => {
                    const div = document.createElement("div");
                    div.className =
                        "px-4 py-3 hover:bg-indigo-50 cursor-pointer border-b last:border-b-0";

                    /* ======================
                       COMPANY
                    ====================== */
                    if (item.type === "company") {
                        div.innerHTML = `
                            <div class="font-semibold text-gray-900">
                                üè¢ ${item.label}
                            </div>
                            <div class="text-xs text-gray-500">
                                ${item.city || ""}
                            </div>
                        `;
                        div.onclick = () => {
                            window.location.href = item.url;
                        };
                    }

                    /* ======================
                       LOCALITY
                    ====================== */
                    else if (item.type === "locality") {
                        div.innerHTML = `üìç ${item.label}`;
                        div.onclick = () => {
                            input.value = item.value;
                            box.classList.add("hidden");
                        };
                    }

                    /* ======================
                       SUB LOCALITY
                    ====================== */
                    else if (item.type === "sub_locality") {
                        div.innerHTML = `üìå ${item.label}`;
                        div.onclick = () => {
                            input.value = item.value;
                            box.classList.add("hidden");
                        };
                    }

                    /* ======================
                       CATEGORY (MPTT)
                    ====================== */
                    else if (item.type === "category") {
                        div.innerHTML = `üóÇ ${item.label}`;
                        div.onclick = () => {
                            input.value = item.label;
                            box.classList.add("hidden");

                            // üîÆ FUTURE READY (optional redirect)
                            // window.location.href = `/category/${item.slug}/`;
                        };
                    }

                    box.appendChild(div);
                });

                box.classList.remove("hidden");
            })
            .catch(err => {
                console.error("Search error:", err);
                box.classList.add("hidden");
            });
    }, 300);
});

/* Hide suggestion box on outside click */
document.addEventListener("click", function (e) {
    if (!box.contains(e.target) && e.target !== input) {
        box.classList.add("hidden");
    }
});
</script>
